<!DOCTYPE html>
<html>
    <head>
        <title>MY First TODO list</title>
    <style>
        ul{
            width:500px;
            display: table;
            margin-left: auto;
            margin-right: auto;
            
        }
        li{
            background-color: rgb(238, 255, 0);
            border: 1px solid white;
            width: 500px;
            display: flex;
            text-align: left;
            

        }
        button.btn{
            color:black;
            border-style: solid;
            border-color: white;
            background-color: rgb(201, 201, 201);
            border-radius: 3px;
            border : 1px;
            margin:3px;


            
        }
        input.check{
            margin-right:10px;
        }
        nav.btns{
            margin-left: auto;
        }

    </style>

    </head>
    <body>
        <script>
            
            todos = JSON.parse(localStorage.getItem('ob'));
            if (todos == null){
                todos = new Array();
            }

            
            
            function showTodo(){
                console.log(todos);
                document.getElementById('todolist').innerHTML = "";
                for (let t in todos){
                    const e = document.createElement('li');

                    checkBox = document.createElement("input");
                    checkBox.setAttribute('type', 'checkbox');
                    checkBox.setAttribute('value', "1");
                    checkBox.setAttribute('onclick', "checkTodo(this)");
                    checkBox.setAttribute('class', 'check');
                    // add check box

                    navBtns = document.createElement('nav');
                    navBtns.setAttribute('class', 'btns');

                    upBtn = document.createElement('button');
                    upBtn.setAttribute('class', 'btn');
                    upBtn.setAttribute('onclick', 'upTodo(this)');
                    upBtn.innerText = 'UP';

                    downBtn = document.createElement('button');
                    downBtn.setAttribute('onclick', 'downTodo(this)');
                    downBtn.setAttribute('class', 'btn');
                    downBtn.innerText = 'DOWN';

                    delBtn = document.createElement('button');
                    delBtn.setAttribute('onclick', 'delTodo(this)');
                    delBtn.setAttribute('class', 'btn');
                    delBtn.innerText = 'DEL';

                    navBtns.append(upBtn, downBtn, delBtn);


                    e.append(checkBox, todos[t]["todo"], navBtns);
                    



                    document.getElementById('todolist').appendChild(e);
                }
                localStorage.setItem('ob', JSON.stringify(todos));
            }
            
            function addTodo(){
                todo = document.getElementById("todo").value;
                t = {"todo":todo, "color":""}
                todos.push(t);
                showTodo();
                document.getElementById("todo").value = "";

            }

            function delTodo(tmp){
                p = tmp.parentNode.parentNode;
                todo = p.innerText;
                todo = todo.substring(0, todo.length-9);
                color = "";
                let i = todos.findIndex(i => i.todo == todo);
                todos.splice(i,1);
                p.remove()
                localStorage.setItem('ob', JSON.stringify(todos));            
            }

            function upTodo(tmp){
                tmp = tmp.parentNode;
                p = tmp.parentNode;
                pre = p.previousSibling;
                pp = p.parentNode;
                if (pre == null){
                    return;
                }
                pp.insertBefore(p, pre);
                localStorage.setItem('ob', JSON.stringify(todos));
                

            }

            function downTodo(tmp){
                tmp = tmp.parentNode;
                p = tmp.parentNode;
                next = p.nextSibling;
                if(next == null){
                    return;
                }
                nnext = next.nextSibling;
                if(nnext == null){
                    pp.appendChild(p);
                    return;
                }
                pp = p.parentNode;
                pp.insertBefore(p, nnext);
                localStorage.setItem('ob', JSON.stringify(todos));

            }

            function checkTodo(tmp){
                check = tmp.checked;
                if (check == false){
                    p.style.color = "black";
                    p.style.textDecoration = '';
                    return;
                }
                
                p = tmp.parentNode;
                todo = p.innerText;
                todo = todo.substring(0, todo.length-9);
                console.log(todo);
                let i = todos.findIndex(i => i.todo == todo);
                todos[i] = {"todo": todo, "color": "checkd"};
                p.style.color = "gray";
                p.style.textDecoration = 'line-through';
            }

        </script> 

        <div align="center">
            <h1>TODO list</h1>
            <input type="text" id="todo" name="todo" value="">
            <button onclick="addTodo()">Add</button>
            <ul id='todolist'> 

            </ul>
        </div>

        <script>
            showTodo()
        </script>
    </body>
</html>